<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ğŸš„ Japan Adventure â€” Bonito Express</title>
  <meta name="theme-color" content="#FF6B9D"/>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Zen+Maru+Gothic:wght@700;900&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    html,body,#root{min-height:100vh;min-height:100dvh}
    body{font-family:'M PLUS Rounded 1c',sans-serif;-webkit-font-smoothing:antialiased;background:#FFF5F9;overflow-x:hidden}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#FFB3D9;border-radius:3px}
    @keyframes yukiFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    @keyframes fadeSlideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes trainMove{0%{transform:translateX(-120%)}100%{transform:translateX(250%)}}
    @keyframes bobble{0%,100%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}}
    @keyframes shimmer{0%{background-position:-200% center}100%{background-position:200% center}}
    @keyframes stickerDrift1{0%,100%{transform:translate(0,0) rotate(0deg)}25%{transform:translate(5px,-8px) rotate(5deg)}50%{transform:translate(-3px,-14px) rotate(-3deg)}75%{transform:translate(4px,-6px) rotate(4deg)}}
    @keyframes stickerDrift2{0%,100%{transform:translate(0,0) rotate(0deg)}33%{transform:translate(-6px,-10px) rotate(-6deg)}66%{transform:translate(4px,-5px) rotate(4deg)}}
    @keyframes stickerBounce{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-12px) scale(1.15)}}
    @keyframes stickerSparkle{0%,100%{opacity:0.1;transform:scale(0.8)}50%{opacity:0.3;transform:scale(1.3)}}
    @keyframes stickerWave{0%,100%{transform:rotate(-10deg)}50%{transform:rotate(10deg)}}
    @keyframes stickerSwing{0%,100%{transform:rotate(-8deg) translateY(0)}50%{transform:rotate(8deg) translateY(-5px)}}
    @keyframes stickerPulse{0%,100%{transform:scale(1);opacity:0.15}50%{transform:scale(1.3);opacity:0.3}}
    @keyframes stickerZoom{0%,100%{transform:translateX(0) scale(1)}50%{transform:translateX(8px) scale(1.1)}}
    @keyframes tabGlow{0%,100%{box-shadow:0 0 0 rgba(255,107,157,0)}50%{box-shadow:0 0 12px rgba(255,107,157,0.3)}}
    @keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
    @keyframes splashBounce{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-25px) scale(1.03)}}
    @keyframes splashFadeIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    @keyframes splashSticker{0%,100%{transform:translateY(0) rotate(0deg) scale(1)}25%{transform:translateY(-12px) rotate(5deg) scale(1.1)}50%{transform:translateY(-20px) rotate(-3deg) scale(1.05)}75%{transform:translateY(-8px) rotate(2deg) scale(1.08)}}
    @keyframes trainRoll{0%{transform:translateX(-150%)}100%{transform:translateX(150%)}}
    @keyframes sparkleFloat{0%,100%{opacity:0;transform:scale(0) translateY(0)}50%{opacity:1;transform:scale(1) translateY(-20px)}}
    @keyframes tailWag{0%,100%{transform-origin:bottom left;transform:rotate(-12deg)}50%{transform-origin:bottom left;transform:rotate(12deg)}}
    @keyframes earTwitch{0%,85%,100%{transform:scaleY(1)}90%{transform:scaleY(0.85)}95%{transform:scaleY(1.05)}}
    textarea,input{font-family:'M PLUS Rounded 1c',sans-serif}
    .edit-btn{background:none;border:1.5px dashed #FFB3D9;border-radius:10px;padding:4px 10px;font-size:11px;color:#FF6B9D;cursor:pointer;font-weight:700;font-family:'M PLUS Rounded 1c',sans-serif;transition:all .2s}
    .edit-btn:hover{background:#FF6B9D10;border-style:solid}
    .save-btn{background:linear-gradient(135deg,#FF6B9D,#C77DFF);border:none;border-radius:10px;padding:6px 14px;font-size:11px;color:white;cursor:pointer;font-weight:900;font-family:'M PLUS Rounded 1c',sans-serif;box-shadow:0 2px 8px rgba(255,107,157,0.3)}
    .note-area{width:100%;border:2px solid #FFE0F0;border-radius:14px;padding:10px 14px;font-size:13px;resize:vertical;min-height:60px;outline:none;font-family:'M PLUS Rounded 1c',sans-serif;transition:border-color .2s;background:#FFFAFC}
    .note-area:focus{border-color:#FF6B9D}
  </style>
</head>
<body>
<div id="root"></div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useEffect,useCallback,useRef}=React;

/* ===== FIREBASE SETUP ===== */
const firebaseConfig={
  apiKey:"AIzaSyD66hIkYuZqPILjVruz0lnAqfrEK29PGog",
  authDomain:"simonoto-828c0.firebaseapp.com",
  databaseURL:"https://simonoto-828c0-default-rtdb.firebaseio.com",
  projectId:"simonoto-828c0",
  storageBucket:"simonoto-828c0.firebasestorage.app",
  messagingSenderId:"578067799039",
  appId:"1:578067799039:web:e43aede4916da472bd25ca"
};
const fbApp=firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const DB_ROOT="bonito-japan";

/* ===== STORAGE HELPERS (Firebase with localStorage offline fallback) ===== */
function dbRef(path){return db.ref(DB_ROOT+"/"+path)}
async function loadData(key,fallback){
  try{
    const snap=await dbRef(key).once("value");
    const val=snap.val();
    if(val!==null)return val;
    // Fallback: check localStorage for migration
    const local=localStorage.getItem("bonito-japan-"+key);
    if(local){const parsed=JSON.parse(local);await saveData(key,parsed);return parsed}
    return fallback;
  }catch(e){console.warn("Firebase read failed, using localStorage",e);
    try{const r=localStorage.getItem("bonito-japan-"+key);return r?JSON.parse(r):fallback}catch(e2){return fallback}
  }
}
async function saveData(key,val){
  try{await dbRef(key).set(val);localStorage.setItem("bonito-japan-"+key,JSON.stringify(val))}catch(e){
    console.warn("Firebase write failed, saving locally",e);
    localStorage.setItem("bonito-japan-"+key,JSON.stringify(val));
  }
}
/* Real-time listener helper */
function onDataChange(key,callback){
  const ref=dbRef(key);
  ref.on("value",snap=>{const val=snap.val();if(val!==null)callback(val)});
  return()=>ref.off("value");
}

/* ===== DEFAULT DATA ===== */
const DEFAULT_DAYS=[
  {id:1,date:"Day 1",title:"Tokyo Arrival âœˆï¸",subtitle:"Shibuya & Harajuku",color:"#FF6B9D",emoji:"ğŸ—¼",note:"",events:[{time:"14:00",title:"Arrive at Narita Airport",icon:"âœˆï¸",type:"travel",note:"Take Narita Express to Shibuya (~90 min)",mapQuery:"Narita+Airport+Tokyo"},{time:"16:00",title:"Check in to Airbnb",icon:"ğŸ ",type:"stay",note:"Drop bags, freshen up",mapQuery:"Shibuya+Station+Tokyo"},{time:"17:30",title:"Explore Takeshita Street",icon:"ğŸ›ï¸",type:"explore",note:"Harajuku's famous kawaii shopping street!",mapQuery:"Takeshita+Street+Harajuku+Tokyo"},{time:"19:00",title:"Dinner at Genki Sushi",icon:"ğŸ£",type:"food",note:"Conveyor belt sushi experience",mapQuery:"Genki+Sushi+Shibuya+Tokyo"},{time:"21:00",title:"Shibuya Crossing at Night",icon:"ğŸŒƒ",type:"explore",note:"See the famous scramble crossing lit up!",mapQuery:"Shibuya+Crossing+Tokyo"}]},
  {id:2,date:"Day 2",title:"Classic Tokyo ğŸ¯",subtitle:"Asakusa & Akihabara",color:"#9B59FF",emoji:"â›©ï¸",note:"",events:[{time:"08:00",title:"Breakfast at Tsukiji Outer Market",icon:"ğŸŸ",type:"food",note:"Fresh sushi & tamagoyaki for breakfast",mapQuery:"Tsukiji+Outer+Market+Tokyo"},{time:"10:00",title:"Senso-ji Temple",icon:"â›©ï¸",type:"explore",note:"Tokyo's oldest temple â€” get fortunes!",mapQuery:"Senso-ji+Temple+Tokyo"},{time:"12:30",title:"Lunch in Asakusa",icon:"ğŸœ",type:"food",note:"Try tempura or monjayaki",mapQuery:"Asakusa+Tokyo"},{time:"14:00",title:"Akihabara Electric Town",icon:"ğŸ®",type:"explore",note:"Anime, games, & electronics paradise",mapQuery:"Akihabara+Tokyo"},{time:"17:00",title:"TeamLab Planets",icon:"ğŸ¨",type:"explore",note:"Immersive digital art â€” book tickets!",mapQuery:"TeamLab+Planets+Tokyo"},{time:"20:00",title:"Ramen in Shinjuku",icon:"ğŸœ",type:"food",note:"Fuunji tsukemen or Ichiran ramen",mapQuery:"Shinjuku+Ramen+Street+Tokyo"}]},
  {id:3,date:"Day 3",title:"Day Trip ğŸ—»",subtitle:"Kamakura",color:"#00C9A7",emoji:"ğŸŒ¸",note:"",events:[{time:"07:30",title:"Early Train Departure",icon:"ğŸš„",type:"travel",note:"Take JR line to Kamakura (~1 hr)",mapQuery:"Kamakura+Station"},{time:"09:00",title:"Great Buddha (Daibutsu)",icon:"ğŸ—¿",type:"explore",note:"Iconic 13m bronze Buddha statue",mapQuery:"Kotoku-in+Kamakura"},{time:"11:00",title:"Hokokuji Bamboo Temple",icon:"ğŸ‹",type:"explore",note:"Stunning bamboo grove + matcha tea",mapQuery:"Hokokuji+Temple+Kamakura"},{time:"12:30",title:"Komachi-dori Street Lunch",icon:"ğŸ¡",type:"food",note:"Street food & cute shops",mapQuery:"Komachi-dori+Kamakura"},{time:"14:30",title:"Enoshima Island",icon:"ğŸï¸",type:"explore",note:"Sea caves, shrines & ocean views",mapQuery:"Enoshima+Island"},{time:"18:00",title:"Return to Tokyo",icon:"ğŸšƒ",type:"travel",note:"Rest up for tomorrow!",mapQuery:"Shibuya+Station+Tokyo"}]},
  {id:4,date:"Day 4",title:"Culture Day ğŸŒ",subtitle:"Meiji Shrine & Omotesando",color:"#FF9F43",emoji:"ğŸ",note:"",events:[{time:"08:00",title:"Meiji Shrine Morning Walk",icon:"â›©ï¸",type:"explore",note:"Peaceful morning at this forest shrine",mapQuery:"Meiji+Shrine+Tokyo"},{time:"10:30",title:"Omotesando Shopping",icon:"ğŸ›ï¸",type:"explore",note:"High-end fashion boulevard",mapQuery:"Omotesando+Tokyo"},{time:"12:00",title:"Cat Cafe Visit",icon:"ğŸ±",type:"explore",note:"Cuddle with cats! Book ahead.",mapQuery:"Cat+Cafe+Harajuku+Tokyo"},{time:"14:00",title:"Yoyogi Park Picnic",icon:"ğŸŒ³",type:"explore",note:"Grab konbini snacks and relax",mapQuery:"Yoyogi+Park+Tokyo"},{time:"16:00",title:"Shinjuku Gyoen Garden",icon:"ğŸŒº",type:"explore",note:"Beautiful traditional garden",mapQuery:"Shinjuku+Gyoen+Tokyo"},{time:"19:00",title:"Golden Gai Bar Hopping",icon:"ğŸ¶",type:"food",note:"Tiny themed bars â€” unforgettable!",mapQuery:"Golden+Gai+Shinjuku+Tokyo"}]},
  {id:5,date:"Day 5",title:"Kyoto Bound ğŸš…",subtitle:"Shinkansen & Temples",color:"#E84393",emoji:"ğŸš„",note:"",events:[{time:"07:00",title:"Shinkansen to Kyoto",icon:"ğŸš…",type:"travel",note:"Bullet train from Tokyo Station (~2.5 hrs)",mapQuery:"Tokyo+Station"},{time:"10:00",title:"Check in Kyoto Airbnb",icon:"ğŸ ",type:"stay",note:"Traditional machiya house stay!",mapQuery:"Kyoto+Station"},{time:"11:30",title:"Fushimi Inari Shrine",icon:"â›©ï¸",type:"explore",note:"Thousands of orange torii gates!",mapQuery:"Fushimi+Inari+Shrine+Kyoto"},{time:"14:00",title:"Nishiki Market Lunch",icon:"ğŸ¡",type:"food",note:"Kyoto's kitchen â€” street food heaven",mapQuery:"Nishiki+Market+Kyoto"},{time:"16:00",title:"Kinkaku-ji Golden Pavilion",icon:"ğŸ¯",type:"explore",note:"The iconic golden temple",mapQuery:"Kinkaku-ji+Kyoto"},{time:"19:00",title:"Pontocho Alley Dinner",icon:"ğŸ®",type:"food",note:"Atmospheric riverside dining",mapQuery:"Pontocho+Alley+Kyoto"}]}
];
const DEFAULT_STAYS=[{name:"Shibuya Cozy Apartment",location:"Shibuya, Tokyo",dates:"Days 1-4",price:"Â¥12,000/night",amenities:["WiFi","Kitchen","Washer","Near Station"],emoji:"ğŸ ",color:"#FF6B9D",airbnbSearch:"Shibuya+Tokyo+Japan",note:""},{name:"Kyoto Machiya House",location:"Higashiyama, Kyoto",dates:"Days 5-7",price:"Â¥15,000/night",amenities:["Traditional","Garden","Futon","Tea Room"],emoji:"ğŸ¡",color:"#9B59FF",airbnbSearch:"Higashiyama+Kyoto+Japan",note:""}];
const DEFAULT_PACKING=[{item:"Passport & Copies",checked:false,emoji:"ğŸ“•"},{item:"JR Pass / IC Card",checked:false,emoji:"ğŸ«"},{item:"Portable WiFi / SIM",checked:false,emoji:"ğŸ“¶"},{item:"Comfortable Walking Shoes",checked:false,emoji:"ğŸ‘Ÿ"},{item:"Universal Adapter",checked:false,emoji:"ğŸ”Œ"},{item:"Cash (Yen)",checked:false,emoji:"ğŸ’´"},{item:"Rain Jacket / Umbrella",checked:false,emoji:"â˜‚ï¸"},{item:"Sunscreen",checked:false,emoji:"ğŸ§´"},{item:"Medications",checked:false,emoji:"ğŸ’Š"},{item:"Snacks for Flight",checked:false,emoji:"ğŸ™"}];
const PHRASES=[{jp:"ã“ã‚“ã«ã¡ã¯",en:"Hello",romaji:"Konnichiwa"},{jp:"ã‚ã‚ŠãŒã¨ã†",en:"Thank you",romaji:"Arigatou"},{jp:"ã™ã¿ã¾ã›ã‚“",en:"Excuse me",romaji:"Sumimasen"},{jp:"ã„ãã‚‰ã§ã™ã‹",en:"How much?",romaji:"Ikura desu ka"},{jp:"ãŠé¡˜ã„ã—ã¾ã™",en:"Please",romaji:"Onegaishimasu"},{jp:"ç¾å‘³ã—ã„ï¼",en:"Delicious!",romaji:"Oishii!"},{jp:"ãƒˆã‚¤ãƒ¬ã¯ã©ã“",en:"Where's the toilet?",romaji:"Toire wa doko"},{jp:"é§…ã¯ã©ã“",en:"Where's the station?",romaji:"Eki wa doko"}];
const typeColors={travel:{bg:"#E8F8FF",border:"#7EC8E3"},food:{bg:"#FFF5E6",border:"#FFB347"},explore:{bg:"#F0FFF0",border:"#77DD77"},stay:{bg:"#FFF0F5",border:"#FF6B9D"}};
const GUIDE_MSGS={home:"ã«ã‚ƒï½ã‚“ï¼Welcome aboard the Bonito Express! ğŸ±ğŸš„ I'm Conductor Bonito â€” your purrfect guide to Japan! Tap âœï¸ to edit anything! ğŸŒ¸âœ¨",itinerary:"Doors closingï½! ã«ã‚ƒï¼ğŸš„ğŸ’¨ Tap any station for Google Maps! Tap âœï¸ to edit stops or add notes! ãƒ”ãƒƒï¼",stays:"Your cozy napping spots! ğŸ âœ¨ Tap âœï¸ to edit details or add notes about your stays! ã«ã‚ƒï½",packing:"Pre-departure checklist! ğŸ’ Tap to check items, âœï¸ to edit, â• to add more! ã«ã‚ƒï¼âœ“",phrases:"Useful phrases for your trip! ğŸ—£ï¸ğŸ“¢ ãŒã‚“ã°ã£ã¦ã«ã‚ƒï½ï¼",notes:"Your personal trip journal! ğŸ“ Write anything â€” ideas, wishlists, reminders! ã«ã‚ƒï½âœ¨",partner:"See what your travel partner has planned! ğŸ¾ You can peek but not edit â€” that's their adventure! ã«ã‚ƒï½"};
const PROFILE_COLORS={A:{primary:"#FF6B9D",accent:"#E84393",name:"Profile A"},B:{primary:"#4ECDC4",accent:"#2C9F97",name:"Profile B"}};

/* ===== SHINKANSEN SVG ===== */
function ShinkansenTrain({width=280}){
  return(<svg width={width} height={Math.round(width*0.14)} viewBox="0 0 280 40" style={{display:"block",transform:"scaleX(-1)"}}>
    <line x1="-10" y1="18" x2="-2" y2="18" stroke="white" strokeWidth="1.5" opacity="0.4"/>
    <line x1="-15" y1="24" x2="-4" y2="24" stroke="white" strokeWidth="1" opacity="0.3"/>
    <path d="M0 28Q8 28 18 24Q28 18 40 16L40 28Q40 32 36 32L4 32Q0 32 0 28Z" fill="white"/>
    <path d="M18 24Q28 18 40 16L40 20Q30 21 20 26Z" fill="#0066CC"/>
    <path d="M2 29Q10 27 20 25Q30 22 40 20L40 22Q30 24 20 27Q10 29 2 31Z" fill="#0066CC"/>
    <circle cx="10" cy="27" r="2.5" fill="#FFE066"/><circle cx="10" cy="27" r="1.5" fill="#FFF8CC"/>
    <rect x="40" y="14" width="190" height="18" rx="2" fill="white"/>
    <rect x="40" y="20" width="190" height="4" fill="#0066CC"/>
    {[0,1,2,3,4,5,6,7,8,9,10,11].map(i=><React.Fragment key={i}><rect x={46+i*16} y={15.5} width="10" height="4" rx="1.5" fill="#B8D8F0"/></React.Fragment>)}
    <rect x="230" y="14" width="20" height="18" rx="2" fill="white"/><rect x="230" y="20" width="20" height="4" fill="#0066CC"/>
    <path d="M250 14Q258 14 260 18L260 28Q258 32 250 32L250 14Z" fill="white"/>
    <path d="M250 20Q256 20 258 22L258 24Q256 26 250 24Z" fill="#0066CC"/>
    <circle cx="257" cy="17" r="1.5" fill="#FF4444"/>
    <rect x="60" y="12" width="170" height="3" rx="1.5" fill="#F0F0F0"/>
    <line x1="120" y1="12" x2="118" y2="6" stroke="#999" strokeWidth="1.5"/><line x1="118" y1="6" x2="126" y2="3" stroke="#999" strokeWidth="1.2"/>
    <rect x="5" y="32" width="250" height="3" rx="1.5" fill="#444"/>
    <rect x="50" y="33" width="24" height="4" rx="2" fill="#333"/><circle cx="56" cy="37" r="2.5" fill="#555"/><circle cx="68" cy="37" r="2.5" fill="#555"/>
    <rect x="180" y="33" width="24" height="4" rx="2" fill="#333"/><circle cx="186" cy="37" r="2.5" fill="#555"/><circle cx="198" cy="37" r="2.5" fill="#555"/>
    <text x="107" y="30" textAnchor="middle" fontSize="5" fill="#0066CC" fontWeight="bold" fontFamily="sans-serif">JR</text>
    <text x="268" y="22" fontSize="10" fill="#FFD700" opacity="0.7">âœ¦</text>
  </svg>);
}

/* ===== CONDUCTOR BONITO â€” Sanrio-Style Orange Cat ===== */
function ConductorBonito({expression="hearts",size=120,animate=true}){
  const eyeV={
    hearts:<React.Fragment>
      <g transform="translate(28,36)"><path d="M6 11 C6 11 0 7 0 3.5 C0 1 1.5 0 3 0 C4.5 0 6 1.5 6 3 C6 1.5 7.5 0 9 0 C10.5 0 12 1 12 3.5 C12 7 6 11 6 11Z" fill="#FF6B9D"/><circle cx="3.5" cy="3" r="1.5" fill="white" opacity="0.7"/></g>
      <g transform="translate(56,36)"><path d="M6 11 C6 11 0 7 0 3.5 C0 1 1.5 0 3 0 C4.5 0 6 1.5 6 3 C6 1.5 7.5 0 9 0 C10.5 0 12 1 12 3.5 C12 7 6 11 6 11Z" fill="#FF6B9D"/><circle cx="3.5" cy="3" r="1.5" fill="white" opacity="0.7"/></g>
    </React.Fragment>,
    stars:<React.Fragment>
      <g transform="translate(30,37)"><polygon points="5,0 6.5,3.5 10,4 7.5,6.5 8,10 5,8.2 2,10 2.5,6.5 0,4 3.5,3.5" fill="#FFD700"/><circle cx="4" cy="4" r="1.3" fill="white" opacity="0.7"/></g>
      <g transform="translate(58,37)"><polygon points="5,0 6.5,3.5 10,4 7.5,6.5 8,10 5,8.2 2,10 2.5,6.5 0,4 3.5,3.5" fill="#FFD700"/><circle cx="4" cy="4" r="1.3" fill="white" opacity="0.7"/></g>
    </React.Fragment>,
    happy:<React.Fragment>
      <ellipse cx="35" cy="42" rx="5" ry="5.5" fill="#2D1B00"/><ellipse cx="63" cy="42" rx="5" ry="5.5" fill="#2D1B00"/>
      <circle cx="37" cy="40" r="2" fill="white"/><circle cx="65" cy="40" r="2" fill="white"/>
      <circle cx="34" cy="43" r="1" fill="white" opacity="0.4"/><circle cx="62" cy="43" r="1" fill="white" opacity="0.4"/>
    </React.Fragment>,
    wink:<React.Fragment>
      <g transform="translate(30,37)"><polygon points="5,0 6.5,3.5 10,4 7.5,6.5 8,10 5,8.2 2,10 2.5,6.5 0,4 3.5,3.5" fill="#FFD700"/><circle cx="4" cy="4" r="1.3" fill="white" opacity="0.7"/></g>
      <path d="M58 43Q63 38 68 43" stroke="#2D1B00" strokeWidth="2.5" fill="none" strokeLinecap="round"/>
      <text x="71" y="39" fontSize="6" fill="#FFD700">âœ¦</text>
    </React.Fragment>
  };
  const mthV={
    hearts:<React.Fragment><path d="M44 51Q46 54 49 51Q52 54 54 51" stroke="#2D1B00" strokeWidth="1.5" fill="none" strokeLinecap="round"/><ellipse cx="49" cy="53" rx="2.5" ry="1.8" fill="#FF9999"/></React.Fragment>,
    stars:<React.Fragment><ellipse cx="49" cy="53" rx="5" ry="4.5" fill="#2D1B00"/><ellipse cx="49" cy="52" rx="4" ry="2" fill="#FF9999"/></React.Fragment>,
    happy:<path d="M44 51Q46 54 49 51Q52 54 54 51" stroke="#2D1B00" strokeWidth="1.5" fill="none" strokeLinecap="round"/>,
    wink:<React.Fragment><path d="M44 51Q46 54 49 51Q52 54 54 51" stroke="#2D1B00" strokeWidth="1.5" fill="none" strokeLinecap="round"/><ellipse cx="49" cy="53" rx="2" ry="1.5" fill="#FF9999"/></React.Fragment>
  };
  return(
    <svg width={size} height={size} viewBox="0 0 100 115" style={animate?{animation:"yukiFloat 3s ease-in-out infinite"}:{}}>
      <defs>
        <linearGradient id="hG2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stopColor="#1B3A5C"/><stop offset="100%" stopColor="#2C5F8A"/></linearGradient>
        <linearGradient id="uG2" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stopColor="#1B3A5C"/><stop offset="100%" stopColor="#15304D"/></linearGradient>
        <linearGradient id="fG2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stopColor="#F4A940"/><stop offset="100%" stopColor="#E8922A"/></linearGradient>
        <radialGradient id="bG2"><stop offset="0%" stopColor="#FFB3B3" stopOpacity="0.7"/><stop offset="100%" stopColor="#FFB3B3" stopOpacity="0"/></radialGradient>
      </defs>
      {/* Tail */}
      <g style={{animation:"tailWag 1.5s ease-in-out infinite"}}>
        <path d="M26 92Q12 82 8 68Q6 60 12 56" stroke="#F4A940" strokeWidth="5.5" fill="none" strokeLinecap="round"/>
        <circle cx="12" cy="56" r="3.5" fill="#F7BC5E"/>
      </g>
      {/* LEFT EAR */}
      <g style={{transformOrigin:"30px 12px",animation:"earTwitch 5s ease-in-out infinite"}}>
        <path d="M22 28L18 2L38 22Z" fill="url(#fG2)" stroke="#E8922A" strokeWidth="0.5"/>
        <path d="M24 25L20.5 7L35 21Z" fill="#FFBBAA"/>
      </g>
      {/* RIGHT EAR */}
      <g style={{transformOrigin:"68px 12px",animation:"earTwitch 5s ease-in-out infinite 2.5s"}}>
        <path d="M76 28L80 2L60 22Z" fill="url(#fG2)" stroke="#E8922A" strokeWidth="0.5"/>
        <path d="M74 25L77.5 7L63 21Z" fill="#FFBBAA"/>
      </g>
      {/* CONDUCTOR HAT */}
      <ellipse cx="49" cy="22" rx="22" ry="4.5" fill="#0F2840"/>
      <ellipse cx="49" cy="21.5" rx="21" ry="4" fill="url(#hG2)"/>
      <path d="M32 21Q32 10 49 7Q66 10 66 21Z" fill="url(#hG2)"/>
      <rect x="32" y="16.5" width="34" height="4.5" fill="#C9A84C"/>
      <rect x="32" y="16.5" width="34" height="1.2" fill="#E8C864" opacity="0.5"/>
      <circle cx="49" cy="13" r="4.5" fill="#C9A84C"/><circle cx="49" cy="13" r="3.2" fill="#1B3A5C"/>
      <text x="49" y="15" textAnchor="middle" fontSize="4.5" fill="#E8C864" fontWeight="bold">JR</text>
      {/* CAT HEAD â€” Sanrio style */}
      <path d="M20 32 Q16 40 18 50 Q20 58 28 62 Q36 66 49 66 Q62 66 70 62 Q78 58 80 50 Q82 40 78 32 Q72 24 49 22 Q26 24 20 32Z" fill="url(#fG2)"/>
      <ellipse cx="49" cy="50" rx="16" ry="12" fill="#F7BC5E"/>
      <ellipse cx="49" cy="55" rx="9" ry="6" fill="#FCCF78" opacity="0.5"/>
      <path d="M40 29L44 33L49 28L54 33L58 29" stroke="#D4802A" strokeWidth="1.2" fill="none" strokeLinecap="round" opacity="0.3"/>
      <ellipse cx="27" cy="48" rx="6" ry="4" fill="url(#bG2)"/>
      <ellipse cx="71" cy="48" rx="6" ry="4" fill="url(#bG2)"/>
      {eyeV[expression]||eyeV.hearts}
      <path d="M10 42Q18 44 26 44" stroke="#D4802A" strokeWidth="0.8" fill="none" opacity="0.45"/>
      <path d="M8 48Q17 48 26 48" stroke="#D4802A" strokeWidth="0.8" fill="none" opacity="0.45"/>
      <path d="M11 54Q19 52 27 51" stroke="#D4802A" strokeWidth="0.8" fill="none" opacity="0.45"/>
      <path d="M88 42Q80 44 72 44" stroke="#D4802A" strokeWidth="0.8" fill="none" opacity="0.45"/>
      <path d="M90 48Q81 48 72 48" stroke="#D4802A" strokeWidth="0.8" fill="none" opacity="0.45"/>
      <path d="M87 54Q79 52 71 51" stroke="#D4802A" strokeWidth="0.8" fill="none" opacity="0.45"/>
      <path d="M46 46L49 48.5L52 46Z" fill="#FF8888"/>
      <line x1="49" y1="48.5" x2="49" y2="50" stroke="#2D1B00" strokeWidth="1" strokeLinecap="round"/>
      {mthV[expression]||mthV.hearts}
      <rect x="41" y="64" width="16" height="5" fill="url(#fG2)" rx="3"/>
      {/* BODY */}
      <path d="M24 70Q24 68 34 66L41 66Q49 68 57 66L64 66Q74 68 74 70L76 106L22 106Z" fill="url(#uG2)"/>
      <circle cx="42" cy="78" r="1.8" fill="#C9A84C"/><circle cx="56" cy="78" r="1.8" fill="#C9A84C"/>
      <circle cx="42" cy="86" r="1.8" fill="#C9A84C"/><circle cx="56" cy="86" r="1.8" fill="#C9A84C"/>
      <circle cx="42" cy="94" r="1.8" fill="#C9A84C"/><circle cx="56" cy="94" r="1.8" fill="#C9A84C"/>
      <path d="M41 66L49 74L57 66" stroke="white" strokeWidth="2.2" fill="none" strokeLinejoin="round"/>
      <rect x="24" y="68" width="12" height="3.5" rx="1.5" fill="#C9A84C"/><rect x="62" y="68" width="12" height="3.5" rx="1.5" fill="#C9A84C"/>
      <rect x="55" y="79" width="18" height="8" rx="4" fill="white" opacity="0.95" stroke="#C9A84C" strokeWidth="0.5"/><text x="64" y="85" textAnchor="middle" fontSize="4.2" fill="#FF6B9D" fontWeight="900" fontFamily="'Zen Maru Gothic',sans-serif" letterSpacing="0.3">BONITO</text>
      <path d="M24 72Q14 76 10 68Q8 63 13 58" stroke="#1B3A5C" strokeWidth="8" fill="none" strokeLinecap="round"/>
      <circle cx="13" cy="57" r="4.5" fill="white"/><circle cx="12" cy="58" r="0.8" fill="#FFD0D0"/><circle cx="15" cy="57" r="0.7" fill="#FFD0D0"/>
      <path d="M74 72Q84 78 86 88" stroke="#1B3A5C" strokeWidth="8" fill="none" strokeLinecap="round"/>
      <circle cx="86" cy="90" r="4.5" fill="white"/><circle cx="85" cy="91" r="0.8" fill="#FFD0D0"/>
      <path d="M41 66Q49 69 57 66" stroke="#FF6B9D" strokeWidth="2.2" fill="none"/>
      <circle cx="49" cy="68" r="2.2" fill="#FFD700" stroke="#E8B800" strokeWidth="0.4"/>
      {expression==="hearts"&&<React.Fragment><text x="16" y="34" fontSize="7" fill="#FF6B9D" opacity="0.6">â™¥</text><text x="80" y="36" fontSize="5" fill="#FF6B9D" opacity="0.4">â™¥</text></React.Fragment>}
      {expression==="stars"&&<React.Fragment><text x="14" y="34" fontSize="6" fill="#FFD700" opacity="0.7">âœ¦</text><text x="82" y="34" fontSize="5" fill="#FFD700" opacity="0.5">âœ§</text></React.Fragment>}
    </svg>
  );
}

function AnimatedStickers(){
  const s=[{emoji:"ğŸŒ¸",x:3,y:5,size:28,speed:4,delay:0,anim:"stickerDrift1"},{emoji:"ğŸ¡",x:88,y:8,size:24,speed:5,delay:.5,anim:"stickerBounce"},{emoji:"â›©ï¸",x:12,y:22,size:22,speed:6,delay:1,anim:"stickerWave"},{emoji:"ğŸ€",x:82,y:25,size:20,speed:3.5,delay:.3,anim:"stickerDrift2"},{emoji:"ğŸ™",x:5,y:40,size:22,speed:4.5,delay:1.5,anim:"stickerBounce"},{emoji:"ğŸ—»",x:92,y:42,size:26,speed:7,delay:0,anim:"stickerDrift1"},{emoji:"âœ¨",x:15,y:58,size:18,speed:2.5,delay:.8,anim:"stickerSparkle"},{emoji:"ğŸŒ",x:90,y:60,size:22,speed:4,delay:1.2,anim:"stickerWave"},{emoji:"ğŸ±",x:8,y:75,size:24,speed:5,delay:.6,anim:"stickerBounce"},{emoji:"ğŸ®",x:85,y:78,size:26,speed:3,delay:1.8,anim:"stickerSwing"},{emoji:"ğŸ’–",x:50,y:12,size:16,speed:3,delay:2,anim:"stickerPulse"},{emoji:"ğŸš„",x:45,y:88,size:20,speed:4,delay:.4,anim:"stickerZoom"},{emoji:"ğŸ£",x:70,y:15,size:20,speed:4.2,delay:.9,anim:"stickerBounce"},{emoji:"ğŸ¾",x:40,y:65,size:14,speed:3,delay:2.5,anim:"stickerDrift2"},{emoji:"ğŸ",x:60,y:55,size:22,speed:5,delay:1.6,anim:"stickerSwing"},{emoji:"ğŸµ",x:75,y:92,size:18,speed:4,delay:.7,anim:"stickerBounce"}];
  return(<div style={{position:"fixed",inset:0,pointerEvents:"none",zIndex:0,overflow:"hidden"}}>{s.map((s,i)=><div key={i} style={{position:"absolute",left:s.x+"%",top:s.y+"%",fontSize:s.size,animation:s.anim+" "+s.speed+"s ease-in-out infinite",animationDelay:s.delay+"s",opacity:.18}}>{s.emoji}</div>)}</div>);
}

function SpeechBubble({message}){
  return(<div style={{background:"white",borderRadius:22,padding:"14px 18px",fontSize:13,fontFamily:"'M PLUS Rounded 1c',sans-serif",color:"#333",boxShadow:"0 4px 20px rgba(255,107,157,0.15)",border:"3px solid #FFE0F0",position:"relative",maxWidth:260,lineHeight:1.6}}>
    <span style={{position:"absolute",top:-10,right:10,fontSize:14,animation:"stickerPulse 2s ease-in-out infinite"}}>âœ¨</span>
    <span style={{position:"absolute",bottom:-8,right:25,fontSize:12,animation:"stickerBounce 2.5s ease-in-out infinite"}}>ğŸ¾</span>
    {message}
    <div style={{position:"absolute",left:-12,bottom:15,width:0,height:0,borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderRight:"14px solid white"}}/>
  </div>);
}

/* ===== EDITABLE FIELD COMPONENT ===== */
function EditableField({value,onSave,placeholder="",multiline=false,style={}}){
  const[editing,setEditing]=useState(false);
  const[val,setVal]=useState(value);
  useEffect(()=>setVal(value),[value]);
  if(!editing)return(<div style={{display:"flex",alignItems:"flex-start",gap:6,...style}}>
    <span style={{flex:1,fontSize:13,color:value?"#555":"#CCC",lineHeight:1.5}}>{value||placeholder}</span>
    <button className="edit-btn" onClick={e=>{e.stopPropagation();setEditing(true)}} style={{flexShrink:0}}>âœï¸</button>
  </div>);
  return(<div style={{display:"flex",flexDirection:"column",gap:6,...style}}>
    {multiline?<textarea className="note-area" onClick={e=>e.stopPropagation()} value={val} onChange={e=>setVal(e.target.value)} placeholder={placeholder} autoFocus/>:
    <input type="text" onClick={e=>e.stopPropagation()} value={val} onChange={e=>setVal(e.target.value)} placeholder={placeholder} autoFocus style={{border:"2px solid #FFE0F0",borderRadius:12,padding:"8px 12px",fontSize:13,outline:"none",background:"#FFFAFC",fontFamily:"'M PLUS Rounded 1c',sans-serif"}} onKeyDown={e=>{e.stopPropagation();if(e.key==="Enter"){onSave(val);setEditing(false)}}}/>}
    <div style={{display:"flex",gap:6,justifyContent:"flex-end"}}>
      <button className="edit-btn" onClick={e=>{e.stopPropagation();setVal(value);setEditing(false)}}>Cancel</button>
      <button className="save-btn" onClick={e=>{e.stopPropagation();onSave(val);setEditing(false)}}>ğŸ’¾ Save</button>
    </div>
  </div>);
}

/* ===== NOTE BOX COMPONENT ===== */
function NoteBox({value,onSave,placeholder="Add a note..."}){
  const[editing,setEditing]=useState(false);
  const[val,setVal]=useState(value||"");
  useEffect(()=>setVal(value||""),[value]);
  return(<div style={{background:"#FFFAFC",border:"2px dashed #FFE0F0",borderRadius:16,padding:12,marginTop:8}}>
    <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:6}}>
      <span style={{fontSize:13,fontWeight:900,color:"#FF6B9D"}}>ğŸ“ Notes</span>
      {!editing&&<button className="edit-btn" onClick={e=>{e.stopPropagation();setEditing(true)}} style={{marginLeft:"auto"}}>âœï¸</button>}
    </div>
    {editing?<React.Fragment>
      <textarea className="note-area" onClick={e=>e.stopPropagation()} value={val} onChange={e=>setVal(e.target.value)} placeholder={placeholder} autoFocus/>
      <div style={{display:"flex",gap:6,justifyContent:"flex-end",marginTop:6}}>
        <button className="edit-btn" onClick={e=>{e.stopPropagation();setVal(value||"");setEditing(false)}}>Cancel</button>
        <button className="save-btn" onClick={e=>{e.stopPropagation();onSave(val);setEditing(false)}}>ğŸ’¾ Save</button>
      </div>
    </React.Fragment>:
    <p style={{fontSize:12,color:val?"#666":"#CCC",lineHeight:1.5,whiteSpace:"pre-wrap"}}>{val||placeholder}</p>}
  </div>);
}

/* ===== PROFILE SELECTOR ===== */
function ProfileSelector({currentProfile,onSwitch}){
  return(<div style={{display:"flex",gap:8,padding:"10px 16px",justifyContent:"center"}}>
    {["A","B"].map(p=>{
      const c=PROFILE_COLORS[p];const active=currentProfile===p;
      return(<button key={p} onClick={()=>onSwitch(p)} style={{background:active?`linear-gradient(135deg,${c.primary},${c.accent})`:"white",color:active?"white":c.primary,border:`2.5px solid ${active?c.primary:c.primary+"30"}`,borderRadius:16,padding:"8px 20px",fontSize:13,fontWeight:900,fontFamily:"'M PLUS Rounded 1c',sans-serif",cursor:"pointer",transition:"all .2s",boxShadow:active?`0 4px 12px ${c.primary}40`:"none",display:"flex",alignItems:"center",gap:6}}>
        <span>{p==="A"?"ğŸŒ¸":"ğŸƒ"}</span>{c.name}
      </button>);
    })}
  </div>);
}

/* ===== MAIN APP ===== */
function App(){
  const[profile,setProfile]=useState("A");
  const[activeTab,setActiveTab]=useState("home");
  const[selectedDayId,setSelectedDayId]=useState(null);
  const[days,setDays]=useState(DEFAULT_DAYS);
  const[stays,setStays]=useState(DEFAULT_STAYS);
  const[packingList,setPackingList]=useState(DEFAULT_PACKING);
  const[generalNotes,setGeneralNotes]=useState("");
  const[partnerDays,setPartnerDays]=useState(null);
  const[partnerNotes,setPartnerNotes]=useState("");
  const[guideExpr,setGuideExpr]=useState("hearts");
  const[showSplash,setShowSplash]=useState(true);
  const[expandedEvent,setExpandedEvent]=useState(null);
  const[loaded,setLoaded]=useState(false);
  const[newPackItem,setNewPackItem]=useState("");
  const selectedDay=days.find(d=>d.id===selectedDayId)||null;

  // Track whether we're currently saving to avoid listener feedback loops
  const saving=useRef(false);
  const skipSync=useRef({days:false,stays:false,packing:false,notes:false});

  // Initial load
  useEffect(()=>{
    (async()=>{
      const d=await loadData(profile+"-days",DEFAULT_DAYS);
      const s=await loadData(profile+"-stays",DEFAULT_STAYS);
      const p=await loadData(profile+"-packing",DEFAULT_PACKING);
      const n=await loadData(profile+"-notes","");
      setDays(d);setStays(s);setPackingList(p);setGeneralNotes(n);
      const other=profile==="A"?"B":"A";
      const pd=await loadData(other+"-days",DEFAULT_DAYS);
      const pn=await loadData(other+"-notes","");
      setPartnerDays(pd);setPartnerNotes(pn);
      setLoaded(true);setSelectedDayId(null);setExpandedEvent(null);
    })();
  },[profile]);

  // Real-time sync listeners â€” updates from other devices appear live
  useEffect(()=>{
    const unsubs=[
      onDataChange(profile+"-days",v=>{if(!skipSync.current.days)setDays(v);skipSync.current.days=false}),
      onDataChange(profile+"-stays",v=>{if(!skipSync.current.stays)setStays(v);skipSync.current.stays=false}),
      onDataChange(profile+"-packing",v=>{if(!skipSync.current.packing)setPackingList(v);skipSync.current.packing=false}),
      onDataChange(profile+"-notes",v=>{if(!skipSync.current.notes)setGeneralNotes(v);skipSync.current.notes=false}),
    ];
    // Also listen for partner changes
    const other=profile==="A"?"B":"A";
    unsubs.push(onDataChange(other+"-days",v=>setPartnerDays(v)));
    unsubs.push(onDataChange(other+"-notes",v=>setPartnerNotes(v)));
    return()=>unsubs.forEach(fn=>fn());
  },[profile]);

  const saveDays=async(d)=>{if(loaded){skipSync.current.days=true;await saveData(profile+"-days",d)}};
  const saveStays=async(s)=>{if(loaded){skipSync.current.stays=true;await saveData(profile+"-stays",s)}};
  const savePacking=async(p)=>{if(loaded){skipSync.current.packing=true;await saveData(profile+"-packing",p)}};
  const saveNotesData=async(n)=>{if(loaded){skipSync.current.notes=true;await saveData(profile+"-notes",n)}};

  const updateDay=(dayId,changes)=>{const nd=days.map(d=>d.id===dayId?{...d,...changes}:d);setDays(nd);saveDays(nd)};
  const updateEvent=(dayId,evIdx,changes)=>{const nd=days.map(d=>{if(d.id!==dayId)return d;const ne=[...d.events];ne[evIdx]={...ne[evIdx],...changes};return{...d,events:ne}});setDays(nd);saveDays(nd)};
  const addEvent=(dayId)=>{const nd=days.map(d=>{if(d.id!==dayId)return d;return{...d,events:[...d.events,{time:"12:00",title:"New Stop",icon:"ğŸ“",type:"explore",note:"",mapQuery:""}]}});setDays(nd);saveDays(nd)};
  const removeEvent=(dayId,evIdx)=>{const nd=days.map(d=>{if(d.id!==dayId)return d;const ne=[...d.events];ne.splice(evIdx,1);return{...d,events:ne}});setDays(nd);saveDays(nd)};
  const updateStay=(idx,changes)=>{const ns=[...stays];ns[idx]={...ns[idx],...changes};setStays(ns);saveStays(ns)};
  const togglePacking=(i)=>{const np=packingList.map((item,idx)=>idx===i?{...item,checked:!item.checked}:item);setPackingList(np);savePacking(np)};
  const addPackItem=()=>{if(!newPackItem.trim())return;const np=[...packingList,{item:newPackItem.trim(),checked:false,emoji:"ğŸ“¦"}];setPackingList(np);setNewPackItem("");savePacking(np)};
  const removePackItem=(i)=>{const np=[...packingList];np.splice(i,1);setPackingList(np);savePacking(np)};
  const addDay=()=>{const newId=Math.max(...days.map(d=>d.id),0)+1;const colors=["#FF6B9D","#9B59FF","#00C9A7","#FF9F43","#E84393","#4ECDC4","#F39C12"];const emojis=["ğŸŒŸ","ğŸ¯","ğŸ—ºï¸","ğŸŒ","âœ¨","ğŸŠ","ğŸŒˆ"];const nd=[...days,{id:newId,date:"Day "+newId,title:"New Day "+emojis[newId%7],subtitle:"Edit me!",color:colors[newId%7],emoji:emojis[newId%7],note:"",events:[]}];setDays(nd);saveDays(nd);setSelectedDayId(newId)};
  const removeDay=(dayId)=>{const nd=days.filter(d=>d.id!==dayId);setDays(nd);saveDays(nd);if(selectedDayId===dayId)setSelectedDayId(nd[0]?.id||null)};
  const addStay=()=>{const colors=["#FF6B9D","#9B59FF","#00C9A7","#FF9F43"];const ns=[...stays,{name:"New Stay",location:"Edit location",dates:"Edit dates",price:"Â¥0/night",amenities:[],emoji:"ğŸ ",color:colors[stays.length%4],airbnbSearch:"Japan",note:""}];setStays(ns);saveStays(ns)};
  const removeStay=(i)=>{const ns=[...stays];ns.splice(i,1);setStays(ns);saveStays(ns)};
  const openMaps=(q)=>window.open("https://www.google.com/maps/search/"+q,"_blank");
  const openAirbnb=(q)=>window.open("https://www.airbnb.com/s/"+q+"/homes","_blank");

  useEffect(()=>{const t=setTimeout(()=>setShowSplash(false),2800);return()=>clearTimeout(t)},[]);
  useEffect(()=>{const ex=["hearts","stars","hearts","wink","stars","happy","hearts"];const iv=setInterval(()=>setGuideExpr(ex[Math.floor(Math.random()*ex.length)]),3000);return()=>clearInterval(iv)},[]);

  const pc=PROFILE_COLORS[profile];

  if(showSplash){
    return(<div style={{minHeight:"100vh",background:"linear-gradient(135deg,#FFE0F0 0%,#FFF0F5 25%,#E8F0FF 50%,#F0E6FF 75%,#FFE0F0 100%)",backgroundSize:"400% 400%",animation:"gradientShift 4s ease infinite",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"hidden",position:"relative"}}>
      {[{e:"ğŸŒ¸",x:8,y:12,s:36},{e:"â­",x:85,y:10,s:28},{e:"ğŸ€",x:10,y:80,s:32},{e:"âœ¨",x:88,y:75,s:26},{e:"ğŸ’–",x:50,y:8,s:24},{e:"ğŸ¾",x:18,y:45,s:22},{e:"ğŸ—»",x:80,y:45,s:30},{e:"ğŸ±",x:92,y:55,s:24}].map((s,i)=><div key={i} style={{position:"fixed",fontSize:s.s,left:s.x+"%",top:s.y+"%",animation:"splashSticker "+(2.5+Math.random()*2)+"s ease-in-out infinite",animationDelay:(i*.2)+"s",opacity:.5}}>{s.e}</div>)}
      <div style={{position:"fixed",bottom:55,left:0,right:0,overflow:"hidden",height:50,opacity:.25}}><div style={{animation:"trainRoll 6s linear infinite"}}><ShinkansenTrain width={240}/></div></div>
      <div style={{animation:"splashBounce 1.8s ease-in-out infinite",zIndex:10}}><ConductorBonito expression="stars" size={180} animate={false}/></div>
      <h1 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:36,background:"linear-gradient(135deg,#FF6B9D,#9B59FF,#FF6B9D)",backgroundSize:"200% auto",animation:"splashFadeIn .8s ease-out .5s both,shimmer 3s linear infinite",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginTop:6,letterSpacing:2,zIndex:10}}>æ—¥æœ¬ã®å†’é™ºï¼</h1>
      <p style={{fontSize:15,color:"#9B59FF",animation:"splashFadeIn .8s ease-out .8s both",fontWeight:700,zIndex:10}}>ï½ All Aboard the Bonito Express ï½ ğŸ±ğŸš„</p>
    </div>);
  }

  return(<div style={{minHeight:"100vh",background:"linear-gradient(180deg,#FFF5F9 0%,#FFF0F5 30%,#F8F0FF 60%,#FFF5F9 100%)",fontFamily:"'M PLUS Rounded 1c',sans-serif",paddingBottom:90,position:"relative",overflow:"hidden"}}>
    <AnimatedStickers/>
    <div style={{background:`linear-gradient(135deg,${pc.primary} 0%,${pc.primary}CC 40%,#C77DFF 70%,#9B59FF 100%)`,padding:"16px 20px 30px",borderRadius:"0 0 32px 32px",position:"relative",zIndex:10,boxShadow:"0 8px 30px rgba(255,107,157,0.3)",overflow:"hidden"}}>
      <span style={{position:"absolute",top:8,right:15,fontSize:18,animation:"stickerPulse 2s ease-in-out infinite",opacity:.4}}>âœ¨</span>
      <span style={{position:"absolute",bottom:14,right:20,fontSize:14,animation:"stickerWave 3s ease-in-out infinite",opacity:.3}}>ğŸŒ</span>
      <div style={{position:"absolute",bottom:2,left:0,right:0,overflow:"hidden",height:24,opacity:.18}}><div style={{animation:"trainMove 8s linear infinite"}}><ShinkansenTrain width={220}/></div></div>
      <div style={{display:"flex",alignItems:"center",gap:12}}>
        <div style={{animation:"bobble 2.5s ease-in-out infinite",flexShrink:0}}><ConductorBonito expression={guideExpr} size={64} animate={false}/></div>
        <div><h1 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:20,color:"white",textShadow:"0 2px 10px rgba(0,0,0,0.15)"}}>ğŸ‡¯ğŸ‡µ Japan Adventure ğŸš„</h1>
        <p style={{color:"rgba(255,255,255,0.9)",fontSize:10,fontWeight:700,marginTop:2}}>Conductor Bonito Â· {pc.name} ğŸ¾</p></div>
      </div>
    </div>
    <ProfileSelector currentProfile={profile} onSwitch={p=>{setProfile(p);setActiveTab("home")}}/>
    <div style={{padding:"8px 20px 12px",display:"flex",gap:10,alignItems:"flex-start",animation:"fadeSlideUp .5s ease-out",position:"relative",zIndex:5}}>
      <div style={{flexShrink:0}}><ConductorBonito expression={guideExpr} size={50}/></div>
      <SpeechBubble message={GUIDE_MSGS[activeTab]}/>
    </div>
    <div style={{padding:"0 16px",position:"relative",zIndex:5}}>

      {activeTab==="home"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        <div style={{display:"flex",justifyContent:"center",gap:8,marginBottom:14}}>{["ğŸŒ¸","ğŸ—¼","â›©ï¸","ğŸ¡","ğŸš„","ğŸŒ","ğŸ¯","ğŸ¾"].map((e,i)=><span key={i} style={{fontSize:20,animation:"stickerBounce "+(2+i*.2)+"s ease-in-out infinite",animationDelay:(i*.12)+"s"}}>{e}</span>)}</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10,marginBottom:18}}>
          {[{label:"Days",value:days.length+"",emoji:"ğŸ“…",color:pc.primary},{label:"Cities",value:"3",emoji:"ğŸ™ï¸",color:"#9B59FF"},{label:"Stops",value:days.reduce((a,d)=>a+d.events.length,0)+"",emoji:"ğŸ“",color:"#00C9A7"}].map((s,i)=><div key={i} style={{background:"white",borderRadius:22,padding:"14px 8px",textAlign:"center",boxShadow:"0 4px 18px rgba(0,0,0,0.04)",border:"2.5px solid "+s.color+"25",animation:"fadeSlideUp .4s ease-out",animationDelay:(i*.1)+"s",animationFillMode:"both"}}><div style={{fontSize:26}}>{s.emoji}</div><div style={{fontSize:26,fontWeight:900,color:s.color,fontFamily:"'Zen Maru Gothic',sans-serif"}}>{s.value}</div><div style={{fontSize:10,color:"#AAA",fontWeight:700}}>{s.label}</div></div>)}
        </div>
        <h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:17,color:pc.primary,marginBottom:10,display:"flex",alignItems:"center",gap:6}}><span style={{animation:"stickerWave 2s ease-in-out infinite"}}>ğŸ±</span> Your Journey Route âœ¨</h2>
        {days.map((day,i)=><div key={day.id} onClick={()=>{setSelectedDayId(day.id);setActiveTab("itinerary")}} style={{background:"white",borderRadius:20,padding:14,marginBottom:10,display:"flex",alignItems:"center",gap:12,boxShadow:"0 4px 16px rgba(0,0,0,0.04)",border:"2.5px solid "+day.color+"18",cursor:"pointer",transition:"all .25s ease",animation:"fadeSlideUp .4s ease-out",animationDelay:(i*.07)+"s",animationFillMode:"both"}} onMouseEnter={e=>{e.currentTarget.style.transform="translateX(6px)";e.currentTarget.style.borderColor=day.color+"60"}} onMouseLeave={e=>{e.currentTarget.style.transform="translateX(0)";e.currentTarget.style.borderColor=day.color+"18"}}>
          <div style={{width:50,height:50,borderRadius:16,background:"linear-gradient(135deg,"+day.color+","+day.color+"88)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:26,flexShrink:0,boxShadow:"0 4px 14px "+day.color+"35"}}>{day.emoji}</div>
          <div style={{flex:1}}><div style={{fontSize:10,color:day.color,fontWeight:900,textTransform:"uppercase",letterSpacing:1}}>{day.date}</div><div style={{fontSize:15,fontWeight:900,color:"#333"}}>{day.title}</div><div style={{fontSize:11,color:"#AAA"}}>{day.subtitle} Â· {day.events.length} stops</div>{day.note&&<div style={{fontSize:10,color:"#FF6B9D",marginTop:2}}>ğŸ“ Has notes</div>}</div>
          <div style={{color:day.color,fontSize:20,fontWeight:900}}>â†’</div>
        </div>)}
        <button onClick={addDay} style={{width:"100%",background:"white",border:"2.5px dashed "+pc.primary+"40",borderRadius:20,padding:"14px",fontSize:13,fontWeight:900,color:pc.primary,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif",marginTop:4,transition:"all .2s"}} onMouseEnter={e=>e.currentTarget.style.borderStyle="solid"} onMouseLeave={e=>e.currentTarget.style.borderStyle="dashed"}>â• Add Day</button>
      </div>}

      {activeTab==="itinerary"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        <div style={{display:"flex",gap:6,marginBottom:14,overflowX:"auto",paddingBottom:4}}>{days.map(day=><button key={day.id} onClick={()=>{setSelectedDayId(day.id);setExpandedEvent(null)}} style={{background:selectedDay?.id===day.id?`linear-gradient(135deg,${day.color},${day.color}BB)`:"white",color:selectedDay?.id===day.id?"white":"#777",border:"2.5px solid "+(selectedDay?.id===day.id?day.color:"#EEE"),borderRadius:14,padding:"7px 14px",fontSize:12,fontWeight:900,fontFamily:"'M PLUS Rounded 1c',sans-serif",cursor:"pointer",whiteSpace:"nowrap",transition:"all .2s",boxShadow:selectedDay?.id===day.id?"0 4px 14px "+day.color+"40":"none"}}>{day.emoji} {day.date}</button>)}</div>
        {selectedDay&&<React.Fragment>
          <div style={{background:`linear-gradient(135deg,${selectedDay.color}12,${selectedDay.color}05)`,borderRadius:20,padding:"14px 16px",marginBottom:14,border:`2.5px solid ${selectedDay.color}18`,position:"relative"}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}><h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:20,color:selectedDay.color}}>{selectedDay.emoji} {selectedDay.title}</h2><button onClick={()=>{if(confirm("Delete this day?"))removeDay(selectedDay.id)}} style={{background:"#FF444420",color:"#FF4444",border:"1.5px solid #FF444440",borderRadius:10,padding:"4px 10px",fontSize:11,fontWeight:900,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>ğŸ—‘ï¸</button></div>
            <EditableField value={selectedDay.subtitle} onSave={v=>updateDay(selectedDay.id,{subtitle:v})} placeholder="Add subtitle..." style={{marginTop:4}}/>
            <NoteBox value={selectedDay.note} onSave={v=>updateDay(selectedDay.id,{note:v})} placeholder="Add day notes..."/>
          </div>
          <div style={{position:"relative",paddingLeft:30}}>
            <div style={{position:"absolute",left:13,top:20,bottom:20,width:4,background:`linear-gradient(to bottom,${selectedDay.color},${selectedDay.color}30)`,borderRadius:2}}/>
            {selectedDay.events.map((ev,i)=>{const tc=typeColors[ev.type];const isExp=expandedEvent===selectedDay.id+"-"+i;return(
              <div key={i} style={{marginBottom:10,animation:"fadeSlideUp .4s ease-out",animationDelay:(i*.05)+"s",animationFillMode:"both"}}>
                <div style={{position:"absolute",left:8,width:14,height:14,borderRadius:"50%",background:isExp?selectedDay.color:"white",border:"3px solid "+selectedDay.color,marginTop:16,transition:"all .2s"}}/>
                <div onClick={()=>setExpandedEvent(isExp?null:selectedDay.id+"-"+i)} style={{background:"white",borderRadius:18,padding:"12px 14px",boxShadow:isExp?"0 6px 20px "+selectedDay.color+"15":"0 2px 10px rgba(0,0,0,0.03)",border:"2.5px solid "+(isExp?selectedDay.color+"50":tc.border+"20"),cursor:"pointer",transition:"all .2s"}}>
                  <div style={{display:"flex",alignItems:"center",gap:8}}>
                    <div style={{width:38,height:38,borderRadius:12,background:tc.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,flexShrink:0}}>{ev.icon}</div>
                    <div style={{flex:1}}>
                      <span style={{fontSize:10,color:selectedDay.color,fontWeight:900,background:selectedDay.color+"12",padding:"2px 8px",borderRadius:8}}>{ev.time}</span>
                      <div style={{fontSize:13,fontWeight:900,color:"#333",marginTop:2}}>{ev.title}</div>
                    </div>
                    <span style={{fontSize:12,transition:"transform .2s",transform:isExp?"rotate(90deg)":"rotate(0)"}}>â–¸</span>
                  </div>
                  {isExp&&<div style={{marginTop:10,paddingTop:10,borderTop:`2px dashed ${selectedDay.color}15`}}>
                    <EditableField value={ev.time} onSave={v=>updateEvent(selectedDay.id,i,{time:v})} placeholder="Time" style={{marginBottom:6}}/>
                    <EditableField value={ev.title} onSave={v=>updateEvent(selectedDay.id,i,{title:v})} placeholder="Title" style={{marginBottom:6}}/>
                    <EditableField value={ev.note} onSave={v=>updateEvent(selectedDay.id,i,{note:v})} placeholder="Add a note..." multiline style={{marginBottom:6}}/>
                    <EditableField value={ev.mapQuery} onSave={v=>updateEvent(selectedDay.id,i,{mapQuery:v})} placeholder="Google Maps search query" style={{marginBottom:8}}/>
                    <div style={{display:"flex",gap:6}}>
                      {ev.mapQuery&&<button onClick={e=>{e.stopPropagation();openMaps(ev.mapQuery)}} style={{flex:1,background:"linear-gradient(135deg,#4285F4,#34A853)",color:"white",border:"none",borderRadius:12,padding:"10px 14px",fontSize:11,fontWeight:900,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>ğŸ“ Google Maps</button>}
                      <button onClick={e=>{e.stopPropagation();removeEvent(selectedDay.id,i)}} style={{background:"#FF4444",color:"white",border:"none",borderRadius:12,padding:"10px 14px",fontSize:11,fontWeight:900,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>ğŸ—‘ï¸</button>
                    </div>
                  </div>}
                </div>
              </div>
            )})}
          </div>
          <button onClick={()=>addEvent(selectedDay.id)} style={{width:"100%",background:"white",border:"2.5px dashed "+selectedDay.color+"40",borderRadius:16,padding:"12px",fontSize:13,fontWeight:900,color:selectedDay.color,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif",marginTop:4,transition:"all .2s"}} onMouseEnter={e=>e.currentTarget.style.borderStyle="solid"} onMouseLeave={e=>e.currentTarget.style.borderStyle="dashed"}>â• Add Stop</button>
        </React.Fragment>}
      </div>}

      {activeTab==="stays"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        <h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:18,color:pc.primary,marginBottom:14}}>ğŸ  Where You're Staying âœ¨</h2>
        {stays.map((acc,i)=><div key={i} style={{background:"white",borderRadius:24,padding:18,marginBottom:14,boxShadow:"0 4px 22px rgba(0,0,0,0.05)",border:"2.5px solid "+acc.color+"18",animation:"fadeSlideUp .4s ease-out",animationDelay:(i*.1)+"s",animationFillMode:"both"}}>
          <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:12}}>
            <div style={{width:52,height:52,borderRadius:18,background:`linear-gradient(135deg,${acc.color}25,${acc.color}08)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:28}}>{acc.emoji}</div>
            <div style={{flex:1}}>
              <EditableField value={acc.name} onSave={v=>updateStay(i,{name:v})} placeholder="Stay name"/>
              <EditableField value={acc.location} onSave={v=>updateStay(i,{location:v})} placeholder="Location" style={{marginTop:2}}/>
            </div>
          </div>
          <div style={{display:"flex",justifyContent:"space-between",background:acc.color+"06",borderRadius:14,padding:"10px 14px",marginBottom:12}}>
            <div><div style={{fontSize:10,color:"#BBB",fontWeight:700}}>DATES</div><EditableField value={acc.dates} onSave={v=>updateStay(i,{dates:v})} placeholder="Dates"/></div>
            <div style={{textAlign:"right"}}><div style={{fontSize:10,color:"#BBB",fontWeight:700}}>PRICE</div><EditableField value={acc.price} onSave={v=>updateStay(i,{price:v})} placeholder="Price"/></div>
          </div>
          <NoteBox value={acc.note} onSave={v=>updateStay(i,{note:v})} placeholder="Add notes about this stay..."/>
          <div style={{display:"flex",gap:8,marginTop:10}}>
            <button onClick={()=>openMaps(acc.airbnbSearch)} style={{flex:1,background:"linear-gradient(135deg,#4285F4,#34A853)",color:"white",border:"none",borderRadius:14,padding:"11px",fontSize:11,fontWeight:900,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>ğŸ“ Maps</button>
            <button onClick={()=>openAirbnb(acc.airbnbSearch)} style={{flex:1,background:"linear-gradient(135deg,#FF5A5F,#FC642D)",color:"white",border:"none",borderRadius:14,padding:"11px",fontSize:11,fontWeight:900,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>ğŸ  Airbnb</button>
            <button onClick={()=>{if(confirm("Remove this stay?"))removeStay(i)}} style={{background:"#FF444420",color:"#FF4444",border:"1.5px solid #FF444440",borderRadius:14,padding:"11px",fontSize:11,fontWeight:900,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>ğŸ—‘ï¸</button>
          </div>
        </div>)}
        <button onClick={addStay} style={{width:"100%",background:"white",border:"2.5px dashed "+pc.primary+"40",borderRadius:20,padding:"14px",fontSize:13,fontWeight:900,color:pc.primary,cursor:"pointer",fontFamily:"'M PLUS Rounded 1c',sans-serif",marginTop:4,transition:"all .2s"}} onMouseEnter={e=>e.currentTarget.style.borderStyle="solid"} onMouseLeave={e=>e.currentTarget.style.borderStyle="dashed"}>â• Add Stay</button>
      </div>}

      {activeTab==="packing"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}>
          <h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:18,color:pc.primary}}>ğŸ’ Packing List</h2>
          <span style={{background:packingList.every(p=>p.checked)?"#77DD7715":"#FF6B9D10",color:packingList.every(p=>p.checked)?"#77DD77":"#FF6B9D",padding:"4px 12px",borderRadius:10,fontSize:11,fontWeight:900}}>{packingList.every(p=>p.checked)?"âœ… Done!":packingList.filter(p=>p.checked).length+"/"+packingList.length}</span>
        </div>
        <div style={{background:"#FFE0F0",borderRadius:10,height:8,marginBottom:14,overflow:"hidden"}}><div style={{background:"linear-gradient(90deg,#FF6B9D,#C77DFF,#9B59FF)",height:"100%",borderRadius:8,width:(packingList.filter(p=>p.checked).length/Math.max(packingList.length,1)*100)+"%",transition:"width .4s ease",backgroundSize:"200% 100%",animation:"shimmer 2s linear infinite"}}/></div>
        {packingList.map((item,i)=><div key={i} style={{background:item.checked?"linear-gradient(135deg,#F0FFF0,#F5FFF5)":"white",borderRadius:16,padding:"12px 14px",marginBottom:6,display:"flex",alignItems:"center",gap:10,cursor:"pointer",border:"2px solid "+(item.checked?"#77DD7730":"#F0F0F0"),transition:"all .2s",animation:"fadeSlideUp .3s ease-out",animationDelay:(i*.03)+"s",animationFillMode:"both"}}>
          <div onClick={()=>togglePacking(i)} style={{width:28,height:28,borderRadius:9,border:"2.5px solid "+(item.checked?"#77DD77":"#DDD"),background:item.checked?"#77DD77":"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,color:"white",fontWeight:900,flexShrink:0,cursor:"pointer"}}>{item.checked?"âœ“":""}</div>
          <span style={{fontSize:18}}>{item.emoji}</span>
          <span style={{fontSize:13,fontWeight:700,color:item.checked?"#AAA":"#333",textDecoration:item.checked?"line-through":"none",flex:1}}>{item.item}</span>
          <button onClick={()=>removePackItem(i)} style={{background:"none",border:"none",fontSize:14,cursor:"pointer",opacity:.3,padding:4}}>âœ•</button>
        </div>)}
        <div style={{display:"flex",gap:6,marginTop:10}}>
          <input value={newPackItem} onChange={e=>setNewPackItem(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")addPackItem()}} placeholder="Add item..." style={{flex:1,border:"2.5px dashed #FFE0F0",borderRadius:14,padding:"10px 14px",fontSize:12,outline:"none",background:"#FFFAFC",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}/>
          <button onClick={addPackItem} className="save-btn" style={{padding:"10px 16px"}}>â•</button>
        </div>
        <div style={{display:"flex",gap:4,flexWrap:"wrap",marginTop:8}}>
          {["ğŸ‘•","ğŸ‘–","ğŸ‘Ÿ","ğŸ§´","ğŸ’Š","ğŸ“±","ğŸ“·","ğŸ”Œ","ğŸ’´","ğŸ«","â˜‚ï¸","ğŸ§³","ğŸ•¶ï¸","ğŸ“•","ğŸ’"].map(em=><button key={em} onClick={()=>{const np=packingList.length>0&&packingList[packingList.length-1].emoji==="ğŸ“¦"?packingList.map((item,idx)=>idx===packingList.length-1?{...item,emoji:em}:item):[...packingList];if(np!==packingList){setPackingList(np);savePacking(np)}}} style={{background:"white",border:"1.5px solid #FFE0F0",borderRadius:10,padding:"4px 7px",fontSize:14,cursor:"pointer",transition:"all .15s"}} title={"Set last item emoji to "+em}>{em}</button>)}
        </div>
      </div>}

      {activeTab==="notes"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        <h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:18,color:pc.primary,marginBottom:14}}>ğŸ“ Trip Journal âœ¨</h2>
        <div style={{background:"white",borderRadius:22,padding:18,boxShadow:"0 4px 20px rgba(0,0,0,0.04)",border:"2.5px solid #FFE0F020"}}>
          <textarea className="note-area" value={generalNotes} onChange={e=>{setGeneralNotes(e.target.value);saveNotesData(e.target.value)}} placeholder="Write anything â€” travel ideas, wishlists, restaurant recommendations, things to remember... ğŸ±âœ¨" style={{minHeight:200,fontSize:14}}/>
        </div>
        <p style={{fontSize:11,color:"#CCC",textAlign:"center",marginTop:10}}>Auto-saved for {pc.name} ğŸ’¾</p>
      </div>}

      {activeTab==="phrases"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        <h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:18,color:pc.primary,marginBottom:14}}>ğŸ—£ï¸ Useful Phrases ğŸ‡¯ğŸ‡µ</h2>
        {PHRASES.map((p,i)=><div key={i} style={{background:"white",borderRadius:20,padding:"14px 16px",marginBottom:8,boxShadow:"0 3px 14px rgba(0,0,0,0.03)",border:"2.5px solid #FFE0F015",animation:"fadeSlideUp .3s ease-out",animationDelay:(i*.05)+"s",animationFillMode:"both",position:"relative"}}>
          <span style={{position:"absolute",top:6,right:10,fontSize:11,opacity:.3,animation:"stickerDrift1 3s ease-in-out infinite "+(i*.2)+"s"}}>{["ğŸŒ¸","â­","ğŸ€","âœ¨","ğŸ’–","ğŸŒŸ","ğŸµ","ğŸ¡"][i]}</span>
          <div style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:26,color:"#333",marginBottom:4}}>{p.jp}</div>
          <div style={{fontSize:13,color:"#FF6B9D",fontWeight:700}}>{p.romaji}</div>
          <div style={{fontSize:11,color:"#AAA"}}>{p.en}</div>
        </div>)}
      </div>}

      {activeTab==="partner"&&<div style={{animation:"fadeSlideUp .4s ease-out"}}>
        {(()=>{const other=profile==="A"?"B":"A";const oc=PROFILE_COLORS[other];return(<React.Fragment>
          <h2 style={{fontFamily:"'Zen Maru Gothic',sans-serif",fontSize:18,color:oc.primary,marginBottom:14}}>{other==="A"?"ğŸŒ¸":"ğŸƒ"} {oc.name}'s Itinerary ğŸ‘€</h2>
          {partnerDays&&partnerDays.map((day,i)=><div key={day.id} style={{background:"white",borderRadius:20,padding:14,marginBottom:10,border:"2.5px solid "+day.color+"18",animation:"fadeSlideUp .4s ease-out",animationDelay:(i*.07)+"s",animationFillMode:"both"}}>
            <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
              <div style={{width:44,height:44,borderRadius:14,background:`linear-gradient(135deg,${day.color},${day.color}88)`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,flexShrink:0}}>{day.emoji}</div>
              <div><div style={{fontSize:10,color:day.color,fontWeight:900,textTransform:"uppercase"}}>{day.date}</div><div style={{fontSize:14,fontWeight:900,color:"#333"}}>{day.title}</div><div style={{fontSize:11,color:"#AAA"}}>{day.subtitle}</div></div>
            </div>
            {day.note&&<div style={{background:"#FFFAFC",border:"1.5px dashed #FFE0F0",borderRadius:12,padding:10,marginBottom:8,fontSize:12,color:"#666"}}>ğŸ“ {day.note}</div>}
            {day.events.map((ev,j)=><div key={j} style={{display:"flex",alignItems:"center",gap:8,padding:"6px 0",borderBottom:j<day.events.length-1?"1px solid #F8F0FF":"none"}}>
              <span style={{fontSize:10,color:day.color,fontWeight:900,width:40}}>{ev.time}</span>
              <span style={{fontSize:16}}>{ev.icon}</span>
              <span style={{fontSize:12,fontWeight:700,color:"#555"}}>{ev.title}</span>
            </div>)}
          </div>)}
          {partnerNotes&&<div style={{background:"white",borderRadius:20,padding:16,border:"2.5px solid "+oc.primary+"18",marginTop:10}}>
            <h3 style={{fontSize:14,color:oc.primary,fontWeight:900,marginBottom:6}}>ğŸ“ Their Notes</h3>
            <p style={{fontSize:12,color:"#666",whiteSpace:"pre-wrap",lineHeight:1.5}}>{partnerNotes}</p>
          </div>}
        </React.Fragment>)})()}
      </div>}
    </div>

    <div style={{position:"fixed",bottom:0,left:0,right:0,background:"rgba(255,255,255,0.92)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:"2.5px solid #FFE0F0",padding:"4px 4px 8px",display:"flex",justifyContent:"space-around",zIndex:100,boxShadow:"0 -4px 25px rgba(255,107,157,0.1)"}}>
      {[{id:"home",icon:"ğŸ ",label:"Home"},{id:"itinerary",icon:"ğŸ—ºï¸",label:"Route"},{id:"stays",icon:"ğŸ¡",label:"Stays"},{id:"packing",icon:"ğŸ’",label:"Pack"},{id:"notes",icon:"ğŸ“",label:"Notes"},{id:"phrases",icon:"ğŸ—£ï¸",label:"Talk"},{id:"partner",icon:"ğŸ‘€",label:"Partner"}].map(tab=><button key={tab.id} onClick={()=>{setActiveTab(tab.id);if(tab.id==="itinerary"&&!selectedDayId)setSelectedDayId(days[0]?.id||null)}} style={{background:activeTab===tab.id?`linear-gradient(135deg,${pc.primary}18,#9B59FF12)`:"transparent",border:activeTab===tab.id?`2px solid ${pc.primary}20`:"2px solid transparent",borderRadius:16,padding:"5px 8px",display:"flex",flexDirection:"column",alignItems:"center",gap:1,cursor:"pointer",transition:"all .2s",transform:activeTab===tab.id?"scale(1.05)":"scale(1)",minWidth:0}}>
        <span style={{fontSize:18}}>{tab.icon}</span>
        <span style={{fontSize:8,fontWeight:900,color:activeTab===tab.id?pc.primary:"#CCC",fontFamily:"'M PLUS Rounded 1c',sans-serif"}}>{tab.label}</span>
        {activeTab===tab.id&&<div style={{width:4,height:4,borderRadius:"50%",background:`linear-gradient(135deg,${pc.primary},#9B59FF)`}}/>}
      </button>)}
    </div>
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>